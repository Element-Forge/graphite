#!/usr/bin/env bash

# Validate commit message format: #<issue> <lowercase description>
# Example: #42 add user authentication

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(head -n 1 "$COMMIT_MSG_FILE")

# Pattern: #<number> <lowercase text, except proper nouns allowed>
# We check: starts with #, followed by number, space, then text (no colon, no period at end)
PATTERN="^#[0-9]+ [a-z].*[^.]$"

# Check for colon after issue number (common mistake)
if [[ "$COMMIT_MSG" =~ ^#[0-9]+: ]]; then
    echo ""
    echo "=========================================="
    echo "  CLAUDE CODE REMINDER"
    echo "=========================================="
    echo ""
    echo " Commit message has colon after issue number."
    echo ""
    echo " Your message:    $COMMIT_MSG"
    echo " Required format: #<issue> <description>"
    echo " Example:         #42 add user authentication"
    echo ""
    echo " Note: No colon after the issue number!"
    echo ""
    echo "=========================================="
    echo ""
    exit 1
fi

# Check for uppercase start (after issue number)
if [[ "$COMMIT_MSG" =~ ^#[0-9]+\ [A-Z] ]]; then
    echo ""
    echo "=========================================="
    echo "  CLAUDE CODE REMINDER"
    echo "=========================================="
    echo ""
    echo " Commit message should be lowercase."
    echo ""
    echo " Your message:    $COMMIT_MSG"
    echo " Required format: #<issue> <lowercase description>"
    echo " Example:         #42 add user authentication"
    echo ""
    echo " Note: Proper nouns (Docker, PostgreSQL) may be capitalized."
    echo ""
    echo "=========================================="
    echo ""
    exit 1
fi

# Check for trailing period
if [[ "$COMMIT_MSG" =~ \\.$ ]]; then
    echo ""
    echo "=========================================="
    echo "  CLAUDE CODE REMINDER"
    echo "=========================================="
    echo ""
    echo " Commit message should not end with a period."
    echo ""
    echo " Your message:    $COMMIT_MSG"
    echo ""
    echo "=========================================="
    echo ""
    exit 1
fi

# Check basic format
if ! [[ "$COMMIT_MSG" =~ ^#[0-9]+\  ]]; then
    echo ""
    echo "=========================================="
    echo "  CLAUDE CODE REMINDER"
    echo "=========================================="
    echo ""
    echo " Commit message must start with issue number."
    echo ""
    echo " Your message:    $COMMIT_MSG"
    echo " Required format: #<issue> <description>"
    echo " Example:         #42 add user authentication"
    echo ""
    echo "=========================================="
    echo ""
    exit 1
fi

exit 0
